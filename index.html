<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>Simple Open-RMF Page</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/roslib@1/build/roslib.min.js"></script>

    <style>
        body { font-family: 'Arial', sans-serif; text-align: center; padding-top: 50px; background-color: #f4f4f4; }
        
        h1 { color: #333; }

        /* 1. ë¡œë´‡ì´ ë‹¤ë‹ ê¸¸ (íŠ¸ë™) */
        .track-container {
            position: relative;
            width: 800px;  /* íŠ¸ë™ ê¸¸ì´ */
            height: 10px;
            background-color: #ccc;
            margin: 50px auto;
            border-radius: 5px;
        }

        /* 2. ì›€ì§ì´ëŠ” ë¡œë´‡ (ì ) */
        .robot-dot {
            position: absolute;
            top: -15px; /* íŠ¸ë™ ìœ„ë¡œ ì‚´ì§ ì˜¬ë¼ì˜´ */
            left: 0px;  /* JS ì½”ë“œë¡œ ì›€ì§ì„ */
            width: 40px;
            height: 40px;
            background-color: #FF0055; 
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: left 0.1s linear; /* ë¶€ë“œëŸ¬ìš´ ì›€ì§ì„ íš¨ê³¼ */
            
            /* ì¤‘ì•™ ì •ë ¬ìš© */
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 12px;
        }

        /* ìƒíƒœì°½ ë””ìì¸ */
        .status-box {
            display: inline-block;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: left;
        }
    </style>
</head>
<body>

    <h1> Open-RMF ì„ í˜• ì›€ì§ì„ í…ŒìŠ¤íŠ¸ 1</h1>

    <div class="track-container">
        <div id="my-robot" class="robot-dot">Bot</div>
    </div>

    <div class="status-box">
        <p><strong>ì—°ê²° ìƒíƒœ:</strong> <span id="status" style="color:red">ğŸ”´ ì—°ê²° ëŠê¹€</span></p>
        <p><strong>ë¡œë´‡ ì´ë¦„:</strong> <span id="bot-name">-</span></p>
        <p><strong>í˜„ì¬ ìœ„ì¹˜ (X):</strong> <span id="pos-x">0.00</span> m</p>
        <p><strong>ë°°í„°ë¦¬:</strong> <span id="battery">0</span> %</p>
    </div>

    <script type="text/javascript">
        // 1. ROSBridge (ì›¹ì†Œì¼“) ì—°ê²°
        var ros = new ROSLIB.Ros({
            url : 'ws://localhost:9090'
        });

        // ì—°ê²° ìƒíƒœ ì²˜ë¦¬
        ros.on('connection', function() {
            document.getElementById("status").innerHTML = "ğŸŸ¢ ì—°ê²°ë¨ (Online)";
            document.getElementById("status").style.color = "green";
        });

        ros.on('error', function(error) {
            document.getElementById("status").innerHTML = "ğŸ”´ ì˜¤ë¥˜ (Rosbridge í™•ì¸í•„ìš”)";
        });

        ros.on('close', function() {
            document.getElementById("status").innerHTML = "âšª ì—°ê²° ì¢…ë£Œ";
        });

        // 2. í† í”½ êµ¬ë… (Topic Subscription)
        var fleetListener = new ROSLIB.Topic({
            ros : ros,
            name : '/fleet_states',
            messageType : 'rmf_fleet_msgs/msg/FleetState'
        });

        // 3. ë°ì´í„°ê°€ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
        fleetListener.subscribe(function(msg) {
            // ë°ì´í„°ê°€ ë¹„ì–´ìˆì§€ ì•Šì€ì§€ í™•ì¸
            if (msg.robots && msg.robots.length > 0) {
                var robot = msg.robots[0];
                var x = robot.location.x; // ì‹¤ì œ ì¢Œí‘œ (0.0 ~ 10.0)

                // í…ìŠ¤íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
                document.getElementById("bot-name").innerText = robot.name;
                document.getElementById("pos-x").innerText = x.toFixed(2);
                document.getElementById("battery").innerText = robot.battery_percent;

                // ì¢Œí‘œë¥¼ í™”ë©´ í”½ì…€ë¡œ ë³€í™˜
                // 0m -> 0px, 10m -> 760px (ë¡œë´‡í¬ê¸° ê³ ë ¤)
                var max_dist = 10.0; 
                var track_width = 760; 
                var pixel_pos = (x / max_dist) * track_width;

                // í™”ë©´ì— ë°˜ì˜
                document.getElementById("my-robot").style.left = pixel_pos + "px";
            }
        });
    </script>
</body>
</html>